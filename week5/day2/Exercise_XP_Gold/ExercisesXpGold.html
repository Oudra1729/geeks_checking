<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Promises Exercises</title>
</head>
<body>

<h1>Promises Exercises</h1>

<script>
/* Exercise 1 : Giphy API #2 */
const giphy = async () => {
    try {
        const response = await fetch("https://api.giphy.com/v1/gifs/search?q=hilarious&rating=g&api_key=hpvZycW22qCjn5cRM1xtWB8NKq4dQ2My");
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        const randomNumber = Math.floor(Math.random() * data.data.length);
        const gifUrl = data.data[randomNumber].images.original.url;
        const img = document.createElement("img");
        img.src = gifUrl;
        img.style.width = "200px";
        document.body.appendChild(img);
    } catch (error) {
        console.error("Error fetching data from Giphy API:", error);
    }
}
giphy();

/* Exercise 2 : Analyze #2 */
let resolveAfter2Seconds = function () {
    console.log("starting slow promise");
    return new Promise(resolve => {
        setTimeout(function () {
            resolve("slow");
            console.log("slow promise is done");
        }, 2000);
    });
};

let resolveAfter1Second = function () {
    console.log("starting fast promise");
    return new Promise(resolve => {
        setTimeout(function () {
            resolve("fast");
            console.log("fast promise is done");
        }, 1000);
    });
};

let sequentialStart = async function () {
    console.log('==SEQUENTIAL START==');
    const slow = await resolveAfter2Seconds();
    console.log(slow);
    const fast = await resolveAfter1Second();
    console.log(fast);
}
sequentialStart();

/* Exercise 3 : Analyze #3 */
let concurrentStart = async function () {
    console.log('==CONCURRENT START with await==');
    const slow = resolveAfter2Seconds();
    const fast = resolveAfter1Second();
    console.log(await slow);
    console.log(await fast);
}
setTimeout(concurrentStart, 4000);

/* Exercise 4 : Modify fetch with Async/Await */
const urls = [
    "https://jsonplaceholder.typicode.com/users",
    "https://jsonplaceholder.typicode.com/WRONG_URL", // to test error handling
    "https://jsonplaceholder.typicode.com/albums"
];

const getData = async function() {
    try {
        const results = await Promise.all(urls.map(async url => {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            return response.json();
        }));

        const [users, posts, albums] = results;
        console.log('users', users);
        console.log('posts', posts);
        console.log('albums', albums);
    } catch (error) {
        console.log("ooooooops", error);
    }
}

getData();
</script>

</body>
</html>
